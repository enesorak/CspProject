<views:ViewBase x:Class="CspProject.Views.SpreadsheetView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
             xmlns:dxsps="http://schemas.devexpress.com/winfx/2008/xaml/spreadsheet"
             xmlns:dxr="http://schemas.devexpress.com/winfx/2008/xaml/ribbon"
             xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
             xmlns:local="clr-namespace:CspProject"
             xmlns:views="clr-namespace:CspProject.Views"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="1000">
    <Grid>
        <!-- 1. Main Spreadsheet Control -->
        <dxsps:SpreadsheetControl x:Name="spreadsheetControl"
                                  CommandBarStyle="Ribbon"
                                  ShowFormulaBar="True"
                                  ShowStatusBar="True">
            <dxsps:SpreadsheetControl.RibbonActions>
                <dxb:RemoveAction ElementName="{x:Static dxsps:DefaultBarItemNames.RibbonPage_File}" />

                <dxb:InsertAction ContainerName="{x:Static dxsps:DefaultBarItemNames.RibbonCategory_Default}" Index="0">
                    <dxr:RibbonPage Caption="File">
                        <dxr:RibbonPageGroup Caption="Actions">
                            <dxb:BarButtonItem Content="Back to Home" RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/Icon Builder/Actions_Home.svg'}"
                                               ItemClick="BackToHome_Click" />
                        </dxr:RibbonPageGroup>
                        <dxr:RibbonPageGroup Caption="File Operations">
                            <dxb:BarButtonItem Content="Open" RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/Actions/Open.svg'}"
                                               ItemClick="OpenButton_Click" />
                            <dxb:BarButtonItem Content="Rename" RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/Dashboards/RenameQuery.svg'}"
                                               ItemClick="RenameButton_Click" />
                            <dxb:BarButtonItem Content="Save" RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/DiagramIcons/save.svg'}"
                                               ItemClick="SaveButton_Click" />
                            <dxb:BarButtonItem Content="Export" RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/Export/ExportToXLSX.svg'}"
                                               ItemClick="ExportButton_Click" />
                        </dxr:RibbonPageGroup>
                      
                            <dxr:RibbonPageGroup Caption="Template Management">
                                <dxb:BarButtonItem x:Name="SaveAsTemplateButton"
                                                   Content="Save as Template"
                                                   ItemClick="SaveAsTemplateButton_Click"
                                                   RibbonStyle="Large"
                                                   Glyph="{dx:DXImage 'SvgImages/Save/SaveAs.svg'}" />
            
                                <dxb:BarButtonItem x:Name="TemplateInfoButton"
                                                   Content="Template Info"
                                                   ItemClick="TemplateInfoButton_Click"
                                                   RibbonStyle="Large"
                                                   Glyph="{dx:DXImage 'SvgImages/Icon Builder/Actions_Info.svg'}" />
                            </dxr:RibbonPageGroup>
                     
                        
                        <dxr:RibbonPageGroup Caption="Print">
                            <dxb:BarButtonItem Content="Quick Print"
                                               Command="{Binding Path=CommandProvider.QuickPrint, ElementName=spreadsheetControl}"
                                               RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/DiagramIcons/QuickPrint.svg'}" />
                            <dxb:BarButtonItem Content="Print"
                                               Command="{Binding Path=CommandProvider.Print, ElementName=spreadsheetControl}"
                                               Glyph="{dx:DXImage 'SvgImages/Dashboards/Print.svg'}" />
                            <dxb:BarButtonItem Content="Print Preview"
                                               Command="{Binding Path=CommandProvider.PrintPreview, ElementName=spreadsheetControl}"
                                               Glyph="{dx:DXImage 'SvgImages/DiagramIcons/ShowPrintPreview.svg'}" />
                        </dxr:RibbonPageGroup>
                        <dxr:RibbonPageGroup Caption="Edit">
                            <dxb:BarButtonItem Content="Undo" RibbonStyle="Large"
                                               Command="{Binding Path=CommandProvider.Undo, ElementName=spreadsheetControl}"
                                               Glyph="{dx:DXImage 'SvgImages/Dashboards/Undo.svg'}" />
                            <dxb:BarButtonItem Content="Redo" RibbonStyle="Large"
                                               Command="{Binding Path=CommandProvider.Redo, ElementName=spreadsheetControl}"
                                               Glyph="{dx:DXImage 'SvgImages/Dashboards/Redo.svg'}" />
                        </dxr:RibbonPageGroup>
                    </dxr:RibbonPage>
                </dxb:InsertAction>

                <dxb:InsertAction ContainerName="{x:Static dxsps:DefaultBarItemNames.RibbonCategory_Default}" Index="3">
                    <dxr:RibbonPage Caption="Workflow">
                        <dxr:RibbonPageGroup Caption="Approval Process">
                            <dxb:BarButtonItem x:Name="SubmitButton" Content="Submit for Review"
                                               ItemClick="SubmitButton_Click" RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/Icon Builder/Actions_Send.svg'}" />
                            <dxb:BarButtonItem x:Name="ApproveButton" Content="Approve" ItemClick="ApproveButton_Click"
                                               RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/DiagramIcons/Check.svg'}" />
                            <dxb:BarButtonItem x:Name="RejectButton" Content="Reject" ItemClick="RejectButton_Click"
                                               RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/Outlook Inspired/Cancel.svg'}" />
                        </dxr:RibbonPageGroup>
                        <dxr:RibbonPageGroup>
                            <dxb:BarButtonItem x:Name="CheckApprovalsButton" Content="Check for Approvals"
                                               ItemClick="CheckApprovalsButton_Click" RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/Icon Builder/Actions_Refresh.svg'}" />
                        </dxr:RibbonPageGroup>
                        <dxr:RibbonPageGroup Caption="Document Status">
                            <dxb:BarStaticItem x:Name="ApprovalStatusLabel" Content="" RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/Content/CheckBox.svg'}" IsVisible="False" />
                        </dxr:RibbonPageGroup>
                    </dxr:RibbonPage>
                </dxb:InsertAction>
                 
                <dxb:InsertAction ContainerName="{x:Static dxsps:DefaultBarItemNames.RibbonCategory_Default}" Index="4">
                    <dxr:RibbonPage Caption="Audit">
                        <dxr:RibbonPageGroup Caption="History">
                            <dxb:BarButtonItem x:Name="DocumentChangeLogButton"
                                               Content="View Change Log"
                                               ItemClick="DocumentChangeLogButton_Click"
                                               RibbonStyle="Large"
                                               Glyph="{dx:DXImage 'SvgImages/Business Objects/BO_Audit_ChangeHistory.svg'}" />
                        </dxr:RibbonPageGroup>
                    </dxr:RibbonPage>
                </dxb:InsertAction>

                <dxb:InsertAction ContainerName="{x:Static dxsps:DefaultBarItemNames.RibbonCategory_Default}" Index="9">
                    <dxr:RibbonPage Caption="About">
                        <dxr:RibbonPageGroup Caption="About">
                            <dxb:BarStaticItem
                                Content="{Binding Source={x:Static local:App.AppVersion}, StringFormat='Version: {0}'}"
                                Glyph="{dx:FontIconSource 59718}" />
                        </dxr:RibbonPageGroup>
                    </dxr:RibbonPage>
                </dxb:InsertAction>
            </dxsps:SpreadsheetControl.RibbonActions>

            <dxsps:SpreadsheetControl.StatusBarActions>
                <dxb:RemoveAction ElementName="{x:Static dxsps:DefaultBarItemNames.StatusBarItem_Min}" />
                <dxb:RemoveAction ElementName="{x:Static dxsps:DefaultBarItemNames.StatusBarItem_Max}" />
                <dxb:RemoveAction ElementName="{x:Static dxsps:DefaultBarItemNames.StatusBarItem_PopupMenu_Min}" />
                <dxb:RemoveAction ElementName="{x:Static dxsps:DefaultBarItemNames.StatusBarItem_PopupMenu_Max}" />
                <dxb:InsertAction ContainerName="{x:Static dxsps:DefaultBarItemNames.StatusBarControl}"
                                  CollectionTag="LeftStatusBarItems">
                    <dxb:BarStaticItem
                        Content="{Binding ElementName=spreadsheetControl, Path=Options.Save.CurrentFileName, Mode=OneWay}"
                        IsVisible="{Binding ElementName=ShowFileName, Path=IsChecked}" />
                </dxb:InsertAction>
            </dxsps:SpreadsheetControl.StatusBarActions>
        </dxsps:SpreadsheetControl>

        <!-- 2. Status Bar -->
        <dxr:RibbonStatusBarControl DockPanel.Dock="Bottom">
            <dxr:RibbonStatusBarControl.LeftItems>
                <dxb:BarStaticItem x:Name="StatusLabel" />
            </dxr:RibbonStatusBarControl.LeftItems>
            <dxr:RibbonStatusBarControl.RightItems>
                <dxb:BarStaticItem x:Name="VersionLabel" />
            </dxr:RibbonStatusBarControl.RightItems>
        </dxr:RibbonStatusBarControl>

        <!-- 3. Right Side Panel - EN SONDA, EN ÜST KATMAN -->
        <Border x:Name="AuditLogPanel"
                Width="450"
                Background="White"
                BorderBrush="#FFE0E0E0"
                BorderThickness="1,0,0,0"
                HorizontalAlignment="Right"
                Visibility="Collapsed"
                Panel.ZIndex="999">
            <Border.Effect>
                <DropShadowEffect Color="Black"
                                  Opacity="0.15"
                                  BlurRadius="20"
                                  ShadowDepth="0" />
            </Border.Effect>
            <Border.RenderTransform>
                <TranslateTransform x:Name="PanelTransform" X="450" />
            </Border.RenderTransform>

            <Grid Background="White">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Header - Sadece Başlık -->
                <Border Grid.Row="0"
                        Background="#FFF8F8F8"
                        Height="60"
                        BorderBrush="#FFE0E0E0"
                        BorderThickness="0,0,0,1">
                    <TextBlock Text="Change History"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="#FF333333"
                               VerticalAlignment="Center"
                               Margin="20" />
                </Border>

                <!-- Export Buttons + Close Button -->
                <StackPanel Grid.Row="1"
                            Orientation="Horizontal"
                            Margin="20,15,20,15"
                            HorizontalAlignment="Left">
                    
                    <!-- Excel Button -->
                    <Button Click="FlyoutExportExcel_Click"
                            Padding="12,8"
                            Margin="0,0,10,0"
                            Background="White"
                            Foreground="#FF333333"
                            BorderBrush="#FFD0D0D0"
                            BorderThickness="1"
                            Cursor="Hand"
                            ToolTip="Export to Excel">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="4"
                                                    Padding="{TemplateBinding Padding}">
                                                <StackPanel Orientation="Horizontal">
                                                    <Path
                                                        Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"
                                                        Fill="#FF217346"
                                                        Width="14"
                                                        Height="14"
                                                        Stretch="Uniform"
                                                        Margin="0,0,8,0" />
                                                    <TextBlock Text="Excel"
                                                               Foreground="#FF333333"
                                                               FontSize="12"
                                                               VerticalAlignment="Center" />
                                                </StackPanel>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FFF5F5F5" />
                                    </Trigger>
                                    <Trigger Property="IsPressed" Value="True">
                                        <Setter Property="Background" Value="#FFE8E8E8" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- PDF Button -->
                    <Button Click="FlyoutExportPdf_Click"
                            Padding="12,8"
                            Margin="0,0,10,0"
                            Background="White"
                            Foreground="#FF333333"
                            BorderBrush="#FFD0D0D0"
                            BorderThickness="1"
                            Cursor="Hand"
                            ToolTip="Export to PDF">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="4"
                                                    Padding="{TemplateBinding Padding}">
                                                <StackPanel Orientation="Horizontal">
                                                    <Path
                                                        Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"
                                                        Fill="#FFD83B01"
                                                        Width="14"
                                                        Height="14"
                                                        Stretch="Uniform"
                                                        Margin="0,0,8,0" />
                                                    <TextBlock Text="PDF"
                                                               Foreground="#FF333333"
                                                               FontSize="12"
                                                               VerticalAlignment="Center" />
                                                </StackPanel>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FFF5F5F5" />
                                    </Trigger>
                                    <Trigger Property="IsPressed" Value="True">
                                        <Setter Property="Background" Value="#FFE8E8E8" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- Close Button (RED) -->
                    <Button Click="CloseAuditPanel_Click"
                            Padding="12,8"
                            Background="#FFDC3545"
                            Foreground="White"
                            BorderBrush="#FFDC3545"
                            BorderThickness="1"
                            Cursor="Hand"
                            ToolTip="Close Panel">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="4"
                                                    Padding="{TemplateBinding Padding}">
                                                <StackPanel Orientation="Horizontal">
                                                    <Path
                                                        Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
                                                        Fill="White"
                                                        Width="14"
                                                        Height="14"
                                                        Stretch="Uniform"
                                                        Margin="0,0,8,0" />
                                                    <TextBlock Text="Close"
                                                               Foreground="White"
                                                               FontSize="12"
                                                               VerticalAlignment="Center" />
                                                </StackPanel>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FFC82333" />
                                    </Trigger>
                                    <Trigger Property="IsPressed" Value="True">
                                        <Setter Property="Background" Value="#FFBD2130" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>

                <!-- Scrollable Content -->
                <ScrollViewer Grid.Row="2"
                              VerticalScrollBarVisibility="Auto"
                              Padding="20,0,20,20">
                    <ScrollViewer.Resources>
                        <!-- Modern Scrollbar Style -->
                        <Style TargetType="{x:Type ScrollBar}">
                            <Setter Property="Width" Value="8" />
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type ScrollBar}">
                                        <Grid>
                                            <Track x:Name="PART_Track" IsDirectionReversed="True">
                                                <Track.Thumb>
                                                    <Thumb>
                                                        <Thumb.Style>
                                                            <Style TargetType="{x:Type Thumb}">
                                                                <Setter Property="Background" Value="#FFCCCCCC" />
                                                                <Setter Property="Template">
                                                                    <Setter.Value>
                                                                        <ControlTemplate TargetType="{x:Type Thumb}">
                                                                            <Border
                                                                                Background="{TemplateBinding Background}"
                                                                                CornerRadius="4"
                                                                                Margin="2,0" />
                                                                        </ControlTemplate>
                                                                    </Setter.Value>
                                                                </Setter>
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter Property="Background" Value="#FF999999" />
                                                                    </Trigger>
                                                                    <Trigger Property="IsDragging" Value="True">
                                                                        <Setter Property="Background" Value="#FF666666" />
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Thumb.Style>
                                                    </Thumb>
                                                </Track.Thumb>
                                            </Track>
                                        </Grid>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ScrollViewer.Resources>

                    <ItemsControl x:Name="AuditLogItemsControl">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#FFFAFAFA"
                                        BorderBrush="#FFE0E0E0"
                                        BorderThickness="1"
                                        CornerRadius="6"
                                        Margin="0,0,0,12"
                                        Padding="16">

                                    <StackPanel>
                                        <!-- Timestamp -->
                                        <Border Background="#FF007ACC"
                                                CornerRadius="3"
                                                Padding="8,4"
                                                Margin="0,0,0,12"
                                                HorizontalAlignment="Left">
                                            <TextBlock
                                                Text="{Binding Timestamp, StringFormat='{}{0:dd/MM/yyyy HH:mm:ss}'}"
                                                FontWeight="Medium"
                                                Foreground="White"
                                                FontSize="11" />
                                        </Border>

                                        <!-- User -->
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="70" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0"
                                                       Text="User:"
                                                       Foreground="#FF666666"
                                                       FontSize="11"
                                                       FontWeight="Medium" />
                                            <TextBlock Grid.Column="1"
                                                       Text="{Binding UserName}"
                                                       Foreground="#FF333333"
                                                       FontSize="11"
                                                       TextWrapping="Wrap" />
                                        </Grid>

                                        <!-- Field Changed -->
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="70" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0"
                                                       Text="Field:"
                                                       Foreground="#FF666666"
                                                       FontSize="11"
                                                       FontWeight="Medium" />
                                            <TextBlock Grid.Column="1"
                                                       Text="{Binding FieldChanged}"
                                                       Foreground="#FF333333"
                                                       FontSize="11"
                                                       TextWrapping="Wrap" />
                                        </Grid>

                                        <!-- Old Value -->
                                        <StackPanel Margin="0,0,0,8">
                                            <TextBlock Text="Old Value:"
                                                       Foreground="#FF666666"
                                                       FontSize="10"
                                                       FontWeight="Medium"
                                                       Margin="0,0,0,4" />
                                            <Border Background="White"
                                                    BorderBrush="#FFE0E0E0"
                                                    BorderThickness="1"
                                                    CornerRadius="4"
                                                    Padding="10,8">
                                                <TextBlock Text="{Binding OldValue}"
                                                           Foreground="#FF666666"
                                                           FontSize="11"
                                                           TextWrapping="Wrap"
                                                           FontFamily="Consolas" />
                                            </Border>
                                        </StackPanel>

                                        <!-- Arrow -->
                                        <Path
                                            Data="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z"
                                            Fill="#FFCCCCCC"
                                            Width="20"
                                            Height="20"
                                            Stretch="Uniform"
                                            HorizontalAlignment="Center"
                                            Margin="0,4,0,8" />

                                        <!-- New Value -->
                                        <StackPanel Margin="0,0,0,12">
                                            <TextBlock Text="New Value:"
                                                       Foreground="#FF666666"
                                                       FontSize="10"
                                                       FontWeight="Medium"
                                                       Margin="0,0,0,4" />
                                            <Border Background="White"
                                                    BorderBrush="#FF007ACC"
                                                    BorderThickness="1"
                                                    CornerRadius="4"
                                                    Padding="10,8">
                                                <TextBlock Text="{Binding NewValue}"
                                                           Foreground="#FF007ACC"
                                                           FontSize="11"
                                                           TextWrapping="Wrap"
                                                           FontFamily="Consolas"
                                                           FontWeight="Medium" />
                                            </Border>
                                        </StackPanel>

                                        <!-- Revision -->
                                        <Border Background="#FFF0F0F0"
                                                CornerRadius="3"
                                                Padding="8,4"
                                                HorizontalAlignment="Right">
                                            <TextBlock Text="{Binding Revision, StringFormat='Rev {0}'}"
                                                       Foreground="#FF666666"
                                                       FontSize="10" />
                                        </Border>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</views:ViewBase>